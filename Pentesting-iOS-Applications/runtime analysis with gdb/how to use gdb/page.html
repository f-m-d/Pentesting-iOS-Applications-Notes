<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>How to use GDB</title>
</head><body>Esempio pratico, allego il PDF:<br/>
https://payatu.com/blog/Sneha-Rajguru/ios-app-runtime-analysis-using-gdb<br/>
<br/>
Per questo caso, prendiamo l'applicazione <b>iOS-Challenge-4</b>:<br/>
<b>L'avviamo e la teniamo in foreground, senza blocco schermo<br/>
<br/>
<br/>
Ora, leggiamo il class dump di questa app:<br/>
<img src="1 2.png" /><br/>
</b><img src="1.png" /><br/>
<br/>
Se ricordiamo: il ViewController dell'app aveva<br/>
un metodo che indicava se il pin era valido!<br/>
<img src="1 3.png" /><b><br/>
</b><br/>
Eseguiamo GDB sull'applicazione:<br/>
<img src="1 4.png" /><br/>
<br/>
<br/>
Si aprirà una shell a riguardo gdb.<br/>
Ora il nostro scopo è di settare un breakpoint<br/>
alla funzione "isValidPin" di RuntimeModificationViewController:<br/>
NB: Si utilizza il simbolo meno (-) per chiamare una classe<br/>
e il due punti (:) per chiamare una funzione!<br/>
<img src="1 5.png" /><br/>
<br/>
Continuiamo il programma:<br/>
<img src="1 6.png" /><br/>
<br/>
Ora andiamo sull'app, inseriamo il pin e clicchiamo il pulsante.<br/>
Il gdb si fermerà al breakpoint.<br/>
<img src="1 7.png" /><br/>
<br/>
<br/>
Ora possiamo usare il comando "disassemble" per<br/>
disassemblare il codice:<br/>
<img src="1 8.png" /><br/>
<br/>
La cosa chiave da ricordare qui è che il metodo<br/>
ritorna un BOOLEAN.<br/>
Vi sarà un certo tipo di check all'interno per validare il pin.<br/>
<br/>
<a href="https://www.keil.com/support/man/docs/armasm/armasm_dom1361289866046.htm">https://www.keil.com/support/man/docs/armasm/armasm_dom1361289866046.htm</a><br/>
Un istruzione utile è <b>BLX (Branch with Link and eXchange instruction set):</b><br/>
essa fa un check e se è true ci porta ad un nuovo set di istruzioni.<br/>
<img src="1 9.png" /><br/>
<br/>
Vediamo meglio cosa è <b>objc_msgSend</b>:<br/>
<a href="https://developer.apple.com/documentation/objectivec/1456712-objc_msgsend">https://developer.apple.com/documentation/objectivec/1456712-objc_msgsend</a><br/>
<img src="1 10.png" /><br/>
<br/>
<br/>
Pe continuare, settiamo il breakpoint<br/>
alla locazione di memoria dove si trova BLX:<br/>
<img src="1 11.png" /><br/>
<br/>
Ora continuiamo l'esecuzione:<br/>
<img src="1 12.png" /><br/>
<br/>
<br/>
A questo punto l'app continua e si blocca al brakpoint.<br/>
Sapendo che il primo argument di questa funzione è <b>l'idReceiver</b>,<br/>
possiamo ottenere le informazioni nei registri e sapere chi è!<br/>
<img src="1 13.png" /><br/>
<br/>
Stampiamo il primo registro r0:<br/>
<a href="https://visualgdb.com/gdbreference/commands/x">https://visualgdb.com/gdbreference/commands/x</a><br/>
<img src="1 14.png" /><br/>
<br/>
Il gdb, esiste un particolare comando<br/>
usato per stampare gli oggetti in C<br/>
detto "po" (print object)<br/>
<br/>
Quindi, stampiamo l'oggetto indirizzato nel registro r0:<br/>
<img src="1 15.png" /><br/>
<br/>
<br/>
L'oggetto indirizzato è la parola <b>demo</b>!<br/>
<br/>
Possiamo analizzare i registri successivi per sapere che succede:<br/>
<a href="https://visualgdb.com/gdbreference/commands/x">https://visualgdb.com/gdbreference/commands/x<br/>
</a><img src="1 16.png" /><br/>
<img src="1 17.png" /><br/>
<br/>
Abbiamo trovato la stringa!<br/>
<br/>
Ora possiamo usare il PIN oppure<br/>
fare altre cose ancora più interessanti.<br/>
<br/>
Dal corso di GNU GDB,<br/>
sappiamo che l'outuput di un confronto<br/>
nei processori ARM si trova in <b>$r0</b><br/>
dell'istruzione successiva!<br/>
<br/>
Quindi prendiamo la locazione<br/>
successiva a BLX e leggiamo nei registri:<br/>
<img src="1 18.png" /><br/>
<br/>
<img src="1 19.png" /><br/>
<br/>
<img src="2.png" /><br/>
<br/>
<img src="1 20.png" /><br/>
<br/>
<br/>
Ora possiamo cambiare questo valore in 1 (true)<br/>
<img src="1 21.png" /><br/>
<br/>
Se continuiamo, possiamo vedere che la challenge è stata risolta!<br/>
<img src="1 22.png" /><br/>
</body></html>